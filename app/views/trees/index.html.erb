<% if !logged_in? %>
<h3 style="text-align:center;">Create an account and sign in to sketch and save your drawings</h3>
<% end %>
      

<div id="index-container">
<div id="separator-bar"></div>
<div class='popular'>
  <h2>Most collaborated on</h2>
  <% @popular.each_with_index do |tree, index| %>
  <a href="<%= tree_path(tree.id) %>">
    <canvas width="600" height="600" class="tree-view-sketches" id="tree-<%= index %>"></canvas>
  </a>
  <p>Click any sketch to see everything in its ancestory.</p>

  <% if tree.sketches.last != nil %>
    <script type="text/javascript">
    var jsonString = '<%= raw tree.sketches.last.json_data %>';
    var treeId = "tree-" + "<%= index %>";
    sketchCanvas = new fabric.StaticCanvas(treeId, {isDrawingMode: false});
    sketchCanvas.loadFromJSON(jsonString, sketchCanvas.renderAll.bind(sketchCanvas));
    $('.tree-view-sketches').css({'border': '1px solid black', 'height': '300px', 'width': '300px'});
    </script>
  <% end %>
  <% end %>
</div>

<div class='recently_added'>
  <h2>Most recent sketch trees</h2>

  <% @latest.each_with_index do |sketch, index| %>
   <a href="<%= new_tree_sketch_path(tree_id: sketch.tree.id ,parent_id: sketch.id) %>">
       <canvas width="600" height="600" class="most-recent-sketches" id="sketch-<%= index %>"></canvas>
   </a>
   <p>Click one of these sketches to edit it directly.</p>

     <script type="text/javascript">
     var jsonString = '<%= raw sketch.json_data %>';
     var treeId = "sketch-" + "<%= index %>";
     sketchCanvas = new fabric.StaticCanvas(treeId, {isDrawingMode: false});
     sketchCanvas.loadFromJSON(jsonString, sketchCanvas.renderAll.bind(sketchCanvas));
     $('.most-recent-sketches').css({'border': '1px solid black', 'height': '200px', 'width': '200px'});
     </script>
  <% end %>
</div>
<div>