<% if !logged_in? %>
<div class='canvas'>
  <%= render "/shared/new_canvas" %>
</div>
<% end %>




<div class='popular'>
  <% @popular.each_with_index do |tree, index| %>
    <a href="<%= tree_path(tree.id) %>">
      <canvas width="600" height="600" class="tree-view-sketches" id="tree-<%= index %>"></canvas>
    </a>

    <script type="text/javascript">
    var jsonString = '<%= raw tree.sketches.last.url %>';
    var treeId = "tree-" + "<%= index %>";
    console.log(treeId);
    sketchCanvas = new fabric.StaticCanvas(treeId, {isDrawingMode: false});
    sketchCanvas.loadFromJSON(jsonString, sketchCanvas.renderAll.bind(sketchCanvas));
    $('.tree-view-sketches').css({'border': '1px solid black'})
    </script>
  <% end %>
</div>

<div class='recently_added'>

  <% @latest.each do |sketch| %>
  <%= javascript_tag do %>
  window.sketch = <%= raw sketch.url.to_json %>
  <% end %>
  <% end %>
</div>
