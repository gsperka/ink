<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style>
.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}

</style>

<%= javascript_tag do %>
  window.treeIDs = <%= raw @tree_json.to_json %>
  window.origin = <%= @origin.to_json %>
<% end %>

<div id='tree-json'>
</div>

<h2>All sketches in this tree</h2>
<% @tree.sketches.each_with_index do |sketch, index| %>
  <a href="<%= tree_sketch_path(@tree, sketch) %>">
    <canvas width="600" height="600" class="tree-view-sketches" id="sketch-<%= index %>"></canvas>
  </a>
  <p>Sketch by: <%= sketch.user.username %> â€” (Click any sketch to see its immediate family.)</p>
  <script type="text/javascript">
    var jsonString = '<%= raw sketch.json_data %>';
    var sketchId = "sketch-" + "<%= index %>";
    sketchCanvas = new fabric.StaticCanvas(sketchId, {isDrawingMode: false});
    sketchCanvas.loadFromJSON(jsonString, sketchCanvas.renderAll.bind(sketchCanvas));
    $('.tree-view-sketches').css({'border': '1px solid black'})
  </script>
<% end %>
